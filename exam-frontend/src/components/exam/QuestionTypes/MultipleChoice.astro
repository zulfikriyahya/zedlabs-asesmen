---
// src/components/exam/QuestionTypes/MultipleChoice.astro
interface Props {
  question: {
    id: number;
    question_text: string;
    question_html?: string;
    media_url?: string;
    media_type?: 'image' | 'audio' | 'video';
    options: Array<{
      id: number;
      option_text: string;
      option_html?: string;
      media_url?: string;
    }>;
  };
  savedAnswer?: number;
  readonly?: boolean;
}

const { question, savedAnswer, readonly = false } = Astro.props;
---

<div class="question-container space-y-6">
  <!-- Question Text -->
  <div class="question-text prose max-w-none">
    {
      question.question_html ? (
        <div set:html={question.question_html} />
      ) : (
        <p class="text-lg">{question.question_text}</p>
      )
    }
  </div>

  <!-- Question Media -->
  {
    question.media_url && (
      <div class="question-media">
        {question.media_type === 'image' && (
          <img
            src={question.media_url}
            alt="Question media"
            class="max-w-full rounded-lg shadow-lg"
          />
        )}

        {question.media_type === 'audio' && (
          <audio controls class="w-full">
            <source src={question.media_url} type="audio/mpeg" />
            Browser Anda tidak mendukung audio player.
          </audio>
        )}

        {question.media_type === 'video' && (
          <video controls class="w-full rounded-lg">
            <source src={question.media_url} type="video/mp4" />
            Browser Anda tidak mendukung video player.
          </video>
        )}
      </div>
    )
  }

  <!-- Options -->
  <div class="options-container space-y-3">
    {
      question.options.map((option, index) => {
        const optionLetter = String.fromCharCode(65 + index); // A, B, C, D...
        const isSelected = savedAnswer === option.id;

        return (
          <label
            class={`option-item flex cursor-pointer items-start gap-4 rounded-lg border-2 p-4 transition-all hover:bg-base-200 ${
              isSelected ? 'border-primary bg-primary/10' : 'border-base-300'
            } ${readonly ? 'cursor-not-allowed opacity-70' : ''}`}
          >
            <input
              type="radio"
              name={`question-${question.id}`}
              value={option.id}
              checked={isSelected}
              disabled={readonly}
              class="radio-primary radio mt-1"
              data-answer-input
            />

            <div class="flex-1">
              <div class="flex items-start gap-3">
                <span class="badge badge-primary badge-lg">{optionLetter}</span>

                <div class="flex-1">
                  {option.option_html ? (
                    <div set:html={option.option_html} />
                  ) : (
                    <p>{option.option_text}</p>
                  )}

                  {option.media_url && (
                    <div class="mt-2">
                      <img
                        src={option.media_url}
                        alt={`Option ${optionLetter}`}
                        class="max-w-xs rounded"
                      />
                    </div>
                  )}
                </div>
              </div>
            </div>
          </label>
        );
      })
    }
  </div>
</div>

<style>
  .option-item {
    transition: all 0.2s ease;
  }

  .option-item:hover:not(.cursor-not-allowed) {
    transform: translateX(4px);
  }

  .option-item input:checked ~ div {
    font-weight: 600;
  }
</style>
