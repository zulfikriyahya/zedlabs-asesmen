---
interface Props {
  id: string;
  label?: string;
  accept?: string; // "image/*,audio/*"
}

const { id, label = "Upload File", accept = "image/*,audio/*,video/*" } = Astro.props;
---

<div class="form-control w-full">
  <label class="label" for={id}>
    <span class="label-text">{label}</span>
  </label>
  
  <div class="flex gap-4 items-start">
    <input 
      type="file" 
      id={id} 
      name={id}
      class="file-input file-input-bordered w-full max-w-xs" 
      accept={accept}
    />
    
    <!-- Preview Container -->
    <div id={`${id}-preview`} class="hidden w-24 h-24 rounded-lg border border-base-300 bg-base-200 flex items-center justify-center overflow-hidden relative">
      <img id={`${id}-img`} class="w-full h-full object-cover hidden" />
      <div id={`${id}-icon`} class="hidden text-2xl">ðŸŽµ</div>
      <button type="button" id={`${id}-clear`} class="btn btn-xs btn-circle btn-error absolute top-1 right-1">âœ•</button>
    </div>
  </div>
</div>

<script define:vars={{ id }}>
  const input = document.getElementById(id);
  const previewBox = document.getElementById(`${id}-preview`);
  const imgPreview = document.getElementById(`${id}-img`);
  const iconPreview = document.getElementById(`${id}-icon`);
  const clearBtn = document.getElementById(`${id}-clear`);

  input.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) return;

    previewBox.classList.remove('hidden');
    
    if (file.type.startsWith('image/')) {
      const url = URL.createObjectURL(file);
      imgPreview.src = url;
      imgPreview.classList.remove('hidden');
      iconPreview.classList.add('hidden');
    } else {
      imgPreview.classList.add('hidden');
      iconPreview.classList.remove('hidden');
      // Set icon based on type
      iconPreview.textContent = file.type.startsWith('audio/') ? 'ðŸŽµ' : 'ðŸŽ¬';
    }
  });

  clearBtn.addEventListener('click', () => {
    input.value = '';
    previewBox.classList.add('hidden');
  });
</script>