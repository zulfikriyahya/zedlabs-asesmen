---
interface Props {
  initialPairs?: Array<{
    left_text: string;
    right_text: string;
    left_media?: string;
    right_media?: string;
  }>;
}

const { initialPairs = [] } = Astro.props;
---

<div class="bg-base-200 rounded-box p-4">
  <div class="flex justify-between items-center mb-4">
    <h4 class="font-bold text-sm">Pasangan Item</h4>
    <span class="text-xs text-base-content/60">Sisi Kiri (Soal) â€” Sisi Kanan (Jawaban)</span>
  </div>

  <div id="pairs-container" class="space-y-4">
    <!-- Pair items injected here -->
  </div>

  <button type="button" id="add-pair-btn" class="btn btn-outline btn-sm btn-block border-dashed mt-4">
    + Tambah Pasangan
  </button>
</div>

<template id="pair-tpl">
  <div class="pair-item card bg-base-100 shadow-sm border border-base-300">
    <div class="card-body p-3">
      <div class="flex flex-col md:flex-row gap-4 items-start md:items-center">
        
        <!-- Left Side -->
        <div class="flex-1 w-full">
          <div class="badge badge-primary badge-xs mb-1">A</div>
          <input type="text" class="left-text input input-bordered input-sm w-full" placeholder="Teks Kiri..." required />
          <!-- Simple Media Trigger -->
          <label class="label cursor-pointer justify-start gap-2 mt-1">
            <input type="checkbox" class="toggle toggle-xs media-toggle" />
            <span class="label-text-alt">Media</span>
          </label>
          <input type="file" class="left-media file-input file-input-bordered file-input-xs w-full hidden" accept="image/*" />
        </div>

        <!-- Connector Icon -->
        <div class="text-base-content/30 rotate-90 md:rotate-0">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
          </svg>
        </div>

        <!-- Right Side -->
        <div class="flex-1 w-full">
          <div class="badge badge-secondary badge-xs mb-1">1</div>
          <input type="text" class="right-text input input-bordered input-sm w-full" placeholder="Teks Kanan..." required />
        </div>

        <!-- Delete Action -->
        <button type="button" class="btn btn-square btn-ghost btn-sm text-error remove-pair">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
          </svg>
        </button>
      </div>
    </div>
  </div>
</template>

<script define:vars={{ initialPairs }}>
  const container = document.getElementById('pairs-container');
  const addBtn = document.getElementById('add-pair-btn');
  const tpl = document.getElementById('pair-tpl');
  let pairCount = 0;

  function addPair(data = null) {
    const clone = tpl.content.cloneNode(true);
    const item = clone.querySelector('.pair-item');
    const leftText = clone.querySelector('.left-text');
    const rightText = clone.querySelector('.right-text');
    const leftBadge = clone.querySelector('.badge-primary');
    const rightBadge = clone.querySelector('.badge-secondary');
    
    // Media toggle logic
    const mediaToggle = clone.querySelector('.media-toggle');
    const mediaInput = clone.querySelector('.left-media');
    
    mediaToggle.addEventListener('change', (e) => {
      if(e.target.checked) mediaInput.classList.remove('hidden');
      else mediaInput.classList.add('hidden');
    });

    // Indexing
    const char = String.fromCharCode(65 + pairCount); // A, B, C...
    leftBadge.textContent = char;
    rightBadge.textContent = (pairCount + 1).toString(); // 1, 2, 3...
    
    if (data) {
      leftText.value = data.left_text;
      rightText.value = data.right_text;
    }

    clone.querySelector('.remove-pair').addEventListener('click', () => {
      item.remove();
      // Re-index logic could be added here if strict ordering is needed
    });

    container.appendChild(clone);
    pairCount++;
  }

  addBtn.addEventListener('click', () => addPair());

  // Init
  if (initialPairs && initialPairs.length > 0) {
    initialPairs.forEach(p => addPair(p));
  } else {
    addPair(); // Default 1 pair
    addPair();
  }
</script>